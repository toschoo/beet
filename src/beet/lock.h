/* ========================================================================
 * (c) Tobias Schoofs, 2018
 * ========================================================================
 * Lock: read/write locks
 * ========================================================================
 */
#ifndef beet_lock_decl
#define beet_lock_decl

#include <beet/types.h>
#include <pthread.h>

/* ------------------------------------------------------------------------
 * Latch for in memory locking
 * ------------------------------------------------------------------------
 */
typedef pthread_mutex_t beet_latch_t;

/* ------------------------------------------------------------------------
 * Latch
 * ------------------------------------------------------------------------
 */
beet_err_t beet_latch_init(beet_latch_t *latch);

/* ------------------------------------------------------------------------
 * Latch
 * ------------------------------------------------------------------------
 */
void beet_latch_destroy(beet_latch_t *latch);

/* ------------------------------------------------------------------------
 * Lock and unlock latch
 * ------------------------------------------------------------------------
 */
beet_err_t beet_latch_lock(beet_latch_t *latch);
beet_err_t beet_latch_unlock(beet_latch_t *latch);

/* ------------------------------------------------------------------------
 * Read/Write Lock for pages
 * ------------------------------------------------------------------------
 */
typedef pthread_rwlock_t beet_lock_t;

/* ------------------------------------------------------------------------
 * Initialise Lock
 * ------------------------------------------------------------------------
 */
beet_err_t beet_lock_init(beet_lock_t *lock);

/* ------------------------------------------------------------------------
 * Destroy Read/Write Lock
 * ------------------------------------------------------------------------
 */
void beet_lock_destroy(beet_lock_t *lock);

/* ------------------------------------------------------------------------
 * Lock Read Lock
 * ------------------------------------------------------------------------
 */
beet_err_t beet_lock_read(beet_lock_t *lock);

/* ------------------------------------------------------------------------
 * Unlock Read Lock
 * ------------------------------------------------------------------------
 */
beet_err_t beet_unlock_read(beet_lock_t *lock);

/* ------------------------------------------------------------------------
 * Lock Write Lock
 * ------------------------------------------------------------------------
 */
beet_err_t beet_lock_write(beet_lock_t *lock);

/* ------------------------------------------------------------------------
 * Unlock Write Lock
 * ------------------------------------------------------------------------
 */
beet_err_t beet_unlock_write(beet_lock_t *lock);

#endif

